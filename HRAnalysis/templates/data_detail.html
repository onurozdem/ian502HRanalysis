{% extends 'base.html' %}

{% block content %}

{% load static %}


	<header id="gtco-header" class="gtco-cover gtco-cover-sm" role="banner"
	        style="background-image:url({% static 'images/analytics2.jpg' %});">
	    <div class="overlay"></div>
	    <div class="gtco-container">
	        <div class="row">
	            <div class="col-md-8 col-md-offset-2 text-center">
	                <div class="display-t">
	                    <div class="display-tc animate-box" data-animate-effect="fadeIn">
	                        <h1>Data Detail</h1>

	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</header>

	<div id="gtco-features">
	    <div class="gtco-container">
			<div class="row">
				<div class="gtco-header">
					<h1 style="color:OrangeRed;"> <u> Dataset View </u> </h1>
				</div>
			</div>
	        <div class="row" style="margin-top:20px;">
				<table id="data" class="display" style="width:100%;">
    			    <thead>
    			        <tr>
    			            <th> Age </th>
							<th> Attrition </th>
							<th> BusinessTravel </th>
							<th> DailyRate </th>
							<th> Department </th>
							<th> DistanceFromHome </th>
							<th> Education </th>
							<th> EducationField </th>
							<th> EmployeeCount </th>
							<th> EmployeeNumber </th>
							<th> EnvironmentSatisfaction </th>
							<th> Gender </th>
							<th> HourlyRate </th>
							<th> JobInvolvement </th>
							<th> JobLevel </th>
							<th> JobRole </th>
							<th> JobSatisfaction </th>
							<th> MaritalStatus </th>
							<th> MonthlyIncome </th>
							<th> MonthlyRate </th>
							<th> NumCompaniesWorked </th>
							<th> Over18 </th>
							<th> OverTime </th>
							<th> PercentSalaryHike </th>
							<th> PerformanceRating </th>
							<th> RelationshipSatisfaction </th>
							<th> StandardHours </th>
							<th> StockOptionLevel </th>
							<th> TotalWorkingYears </th>
							<th> TrainingTimesLastYear </th>
							<th> WorkLifeBalance </th>
							<th> YearsAtCompany </th>
							<th> YearsInCurrentRole </th>
							<th> YearsSinceLastPromotion </th>
							<th> YearsWithCurrManager </th>
    			        </tr>
    			    </thead>
    			    <tfoot>
    			        <tr>
    			            <th> Age </th>
							<th> Attrition </th>
							<th> BusinessTravel </th>
							<th> DailyRate </th>
							<th> Department </th>
							<th> DistanceFromHome </th>
							<th> Education </th>
							<th> EducationField </th>
							<th> EmployeeCount </th>
							<th> EmployeeNumber </th>
							<th> EnvironmentSatisfaction </th>
							<th> Gender </th>
							<th> HourlyRate </th>
							<th> JobInvolvement </th>
							<th> JobLevel </th>
							<th> JobRole </th>
							<th> JobSatisfaction </th>
							<th> MaritalStatus </th>
							<th> MonthlyIncome </th>
							<th> MonthlyRate </th>
							<th> NumCompaniesWorked </th>
							<th> Over18 </th>
							<th> OverTime </th>
							<th> PercentSalaryHike </th>
							<th> PerformanceRating </th>
							<th> RelationshipSatisfaction </th>
							<th> StandardHours </th>
							<th> StockOptionLevel </th>
							<th> TotalWorkingYears </th>
							<th> TrainingTimesLastYear </th>
							<th> WorkLifeBalance </th>
							<th> YearsAtCompany </th>
							<th> YearsInCurrentRole </th>
							<th> YearsSinceLastPromotion </th>
							<th> YearsWithCurrManager </th>
    			        </tr>
    			    </tfoot>
    			</table>
	        </div>
	    </div>
	</div>

	<div id="gtco-features-2">
		<div class="gtco-container">
			<div class="row">
				<div class="gtco-header">
					<h1 style="color:OrangeRed;"> <u> Correlation </u> </h1>
				</div>
			</div>
			<div class="row">
				Order:
	            <select id="order">
	                <option value="probecontrast">by row name and column name</option>
	                <option value="probe">by column name</option>
	                <option value="contrast">by row name</option>
	                <option value="custom">by correlation</option>
	            </select>
	            <div id="chart" style='overflow:auto; width:1000px; height:1080px;'></div>
			</div>
	    </div>
	</div>

	<div id="gtco-features">
	    <div class="gtco-container">
			<div class="row">
				<div class="gtco-header">
					<h1 style="color:OrangeRed;"> <u> Distribution View </u> </h1>
				</div>
			</div>
			<div class="row" style="margin-top:20px;">
	        	<div class="col-md-5 col-sm-5" id="my_boxplot1">

				</div>
				<div class="col-md-5 col-sm-5" id="my_boxplot2">

				</div>
	        </div>
			<div class="row">
	        	<div id="my_boxplot3">

				</div>
	        </div>
			<div class="row">
				<div id="my_boxplot4">

				</div>
	        </div>

	    </div>
	</div>

	<div id="gtco-subscribe">
		<div class="gtco-container">
		</div>
	</div>

    <!-- All Data Table -->
	<script type="text/javascript">
		$(document).ready(function() {
		    $('#data').DataTable( {data: {{table_data|safe}},
		            autoWidth: true,
		            scrollX: true}
		     );
		} );
	</script>

	<!-- Correlation -->
	<script type="text/javascript">
		var margin = { top: 150, right: 10, bottom: 50, left: 100 },
		  cellSize=20;
		  col_number=35;
		  row_number=35;
		  width = cellSize*col_number, // - margin.left - margin.right,
		  height = (cellSize*row_number), // - margin.top - margin.bottom,
		  //gridSize = Math.floor(width / 24),
		  legendElementWidth = cellSize*2.5,
		  colorBuckets = 9,
		  colors = ['#9B1A53', '#BB6990','#D19EB9','#DBB9CD', '#F7F9F9', '#B8D4CB','#83B09B', '#4F8D6B', '#005824'] ;
		  hcrow = [49,11,30,4,18,6,12,20,19,33,32,26,44,35,38,3,23,41,22,10,2,15,16,36,8,25,29,7,27,34,48,31,45,43,14], // change to gene name or probe id
		  hccol = [6,5,41,12,42,21,58,56,14,16,43,15,17,46,47,48,54,49,37,38,25,22,7,8,2,45,9,20,24,44,23,19,13,40,11], // change to gene name or probe id
		  rowLabel = ["id", "Age", "Attrition", "BusinessTravel", "DailyRate", "Department", "DistanceFromHome", "Education", "EducationField", "EmployeeCount", "EmployeeNumber", "EnvironmentSatisfaction", "Gender", "HourlyRate", "JobInvolvement", "JobLevel", "JobRole", "JobSatisfaction", "MaritalStatus", "MonthlyIncome", "MonthlyRate", "NumCompaniesWorked", "Over18", "OverTime", "PercentSalaryHike", "PerformanceRating", "RelationshipSatisfaction", "StandardHours", "StockOptionLevel", "TotalWorkingYears", "TrainingTimesLastYear", "WorkLifeBalance", "YearsAtCompany", "YearsInCurrentRole", "YearsSinceLastPromotion", "YearsWithCurrManager"] ,  // change to gene name or probe id
		  colLabel = ["id", "Age", "Attrition", "BusinessTravel", "DailyRate", "Department", "DistanceFromHome", "Education", "EducationField", "EmployeeCount", "EmployeeNumber", "EnvironmentSatisfaction", "Gender", "HourlyRate", "JobInvolvement", "JobLevel", "JobRole", "JobSatisfaction", "MaritalStatus", "MonthlyIncome", "MonthlyRate", "NumCompaniesWorked", "Over18", "OverTime", "PercentSalaryHike", "PerformanceRating", "RelationshipSatisfaction", "StandardHours", "StockOptionLevel", "TotalWorkingYears", "TrainingTimesLastYear", "WorkLifeBalance", "YearsAtCompany", "YearsInCurrentRole", "YearsSinceLastPromotion", "YearsWithCurrManager"] ; // change to contrast name

		d3.tsv("{%static 'data/heatmap.tsv' %}",
		function(d) {
		  return {
		    row:   +d.row_idx,
		    col:   +d.col_idx,
		    value: +d.log2ratio
		  };
		},
		function(error, data) {
		  var colorScale = d3.scale.quantile()
		      .domain([ -1 , 0, 1])
		      .range(colors);

		  var svg = d3.select("#chart").append("svg")
		      .attr("width", width + margin.left + margin.right)
		      .attr("height", height + margin.top + margin.bottom + 100)
		      .append("g")
		      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
		      ;
		  var rowSortOrder=false;
		  var colSortOrder=false;
		  var rowLabels = svg.append("g")
		      .selectAll(".rowLabelg")
		      .data(rowLabel)
		      .enter()
		      .append("text")
		      .text(function (d) { return d; })
		      .attr("x", 0)
		      .attr("y", function (d, i) { return hcrow.indexOf(i+1) * cellSize; })
		      .style("text-anchor", "end")
		      .attr("transform", "translate(-6," + cellSize / 1.5 + ")")
		      .attr("class", function (d,i) { return "rowLabel mono r"+i;} )
		      .on("mouseover", function(d) {d3.select(this).classed("text-hover",true);})
		      .on("mouseout" , function(d) {d3.select(this).classed("text-hover",false);})
		      .on("click", function(d,i) {rowSortOrder=!rowSortOrder; sortbylabel("r",i,rowSortOrder);d3.select("#order").property("selectedIndex", 1).node().focus();;})
		      ;

		  var colLabels = svg.append("g")
		      .selectAll(".colLabelg")
		      .data(colLabel)
		      .enter()
		      .append("text")
		      .text(function (d) { return d; })
		      .attr("x", 0)
		      .attr("y", function (d, i) { return hccol.indexOf(i+1) * cellSize; })
		      .style("text-anchor", "left")
		      .attr("transform", "translate("+cellSize/2 + ",-6) rotate (-90)")
		      .attr("class",  function (d,i) { return "colLabel mono c"+i;} )
		      .on("mouseover", function(d) {d3.select(this).classed("text-hover",true);})
		      .on("mouseout" , function(d) {d3.select(this).classed("text-hover",false);})
		      .on("click", function(d,i) {colSortOrder=!colSortOrder;  sortbylabel("c",i,colSortOrder);d3.select("#order").property("selectedIndex", 4).node().focus();;})
		      ;

		  var heatMap = svg.append("g").attr("class","g3")
		        .selectAll(".cellg")
		        .data(data,function(d){return d.row+":"+d.col;})
		        .enter()
		        .append("rect")
		        .attr("x", function(d) { return hccol.indexOf(d.col) * cellSize; })
		        .attr("y", function(d) { return hcrow.indexOf(d.row) * cellSize; })
		        .attr("class", function(d){return "cell cell-border cr"+(d.row-1)+" cc"+(d.col-1);})
		        .attr("width", cellSize)
		        .attr("height", cellSize)
		        .style("fill", function(d) { return colorScale(d.value); })
		        /* .on("click", function(d) {
		               var rowtext=d3.select(".r"+(d.row-1));
		               if(rowtext.classed("text-selected")==false){
		                   rowtext.classed("text-selected",true);
		               }else{
		                   rowtext.classed("text-selected",false);
		               }
		        })*/
		        .on("mouseover", function(d){
		               //highlight text
		               d3.select(this).classed("cell-hover",true);
		               d3.selectAll(".rowLabel").classed("text-highlight",function(r,ri){ return ri==(d.row-1);});
		               d3.selectAll(".colLabel").classed("text-highlight",function(c,ci){ return ci==(d.col-1);});

		               //Update the tooltip position and value
		               d3.select("#tooltip")
		                 .style("left", (d3.event.pageX+10) + "px")
		                 .style("top", (d3.event.pageY-10) + "px")
		                 .select("#value")
		                 .text("lables:"+rowLabel[d.row-1]+","+colLabel[d.col-1]+"\ndata:"+d.value+"\nrow-col-idx:"+d.col+","+d.row+"\ncell-xy "+this.x.baseVal.value+", "+this.y.baseVal.value);
		               //Show the tooltip
		               d3.select("#tooltip").classed("hidden", false);
		        })
		        .on("mouseout", function(){
		               d3.select(this).classed("cell-hover",false);
		               d3.selectAll(".rowLabel").classed("text-highlight",false);
		               d3.selectAll(".colLabel").classed("text-highlight",false);
		               d3.select("#tooltip").classed("hidden", true);
		        })
		        ;

		  var legend = svg.selectAll(".legend")
		      .data([-1, -0.75, -0.5, 0.25, 0, 0.25, 0.5, 0.75, 1])
		      .enter().append("g")
		      .attr("class", "legend");

		  legend.append("rect")
		    .attr("x", function(d, i) { return legendElementWidth * i; })
		    .attr("y", height+(cellSize*2))
		    .attr("width", legendElementWidth)
		    .attr("height", cellSize)
		    .style("fill", function(d, i) { return colors[i]; });

		  legend.append("text")
		    .attr("class", "mono")
		    .text(function(d) { return d; })
		    .attr("width", legendElementWidth)
		    .attr("x", function(d, i) { return legendElementWidth * i; })
		    .attr("y", height + (cellSize*4));

		// Change ordering of cells

		  function sortbylabel(rORc,i,sortOrder){
		       var t = svg.transition().duration(3000);
		       var log2r=[];
		       var sorted; // sorted is zero-based index
		       d3.selectAll(".c"+rORc+i)
		         .filter(function(ce){
		            log2r.push(ce.value);
		          })
		       ;
		       if(rORc=="r"){ // sort log2ratio of a gene
		         sorted=d3.range(col_number).sort(function(a,b){ if(sortOrder){ return log2r[b]-log2r[a];}else{ return log2r[a]-log2r[b];}});
		         t.selectAll(".cell")
		           .attr("x", function(d) { return sorted.indexOf(d.col-1) * cellSize; })
		           ;
		         t.selectAll(".colLabel")
		          .attr("y", function (d, i) { return sorted.indexOf(i) * cellSize; })
		         ;
		       }else{ // sort log2ratio of a contrast
		         sorted=d3.range(row_number).sort(function(a,b){if(sortOrder){ return log2r[b]-log2r[a];}else{ return log2r[a]-log2r[b];}});
		         t.selectAll(".cell")
		           .attr("y", function(d) { return sorted.indexOf(d.row-1) * cellSize; })
		           ;
		         t.selectAll(".rowLabel")
		          .attr("y", function (d, i) { return sorted.indexOf(i) * cellSize; })
		         ;
		       }
		  }

		  order("probecontrast");

		  d3.select("#order").on("change",function(){
		    order(this.value);
		  });

		  function order(value){
		   if (value=="probecontrast"){
		    var t = svg.transition().duration(3000);
		    t.selectAll(".cell")
		      .attr("x", function(d) { return (d.col - 1) * cellSize; })
		      .attr("y", function(d) { return (d.row - 1) * cellSize; })
		      ;

		    t.selectAll(".rowLabel")
		      .attr("y", function (d, i) { return i * cellSize; })
		      ;

		    t.selectAll(".colLabel")
		      .attr("y", function (d, i) { return i * cellSize; })
		      ;

		   }else if (value=="probe"){
		    var t = svg.transition().duration(3000);
		    t.selectAll(".cell")
		      .attr("y", function(d) { return (d.row - 1) * cellSize; })
		      ;

		    t.selectAll(".rowLabel")
		      .attr("y", function (d, i) { return i * cellSize; })
		      ;
		   }else if (value=="contrast"){
		    var t = svg.transition().duration(3000);
		    t.selectAll(".cell")
		      .attr("x", function(d) { return (d.col - 1) * cellSize; })
		      ;
		    t.selectAll(".colLabel")
		      .attr("y", function (d, i) { return i * cellSize; })
		      ;
		   }
		   else if (value=="custom"){
		    var t = svg.transition().duration(3000);
		    t.selectAll(".cell")
		      .attr("x", function(d) { return (d.col - 1) * cellSize; })
		      ;
		    t.selectAll(".colLabel")
		      .attr("y", function (d, i) { return i * cellSize; })
		      ;
		   }
		  }
		  //
		  var sa=d3.select(".g3")
		      .on("mousedown", function() {
		          if( !d3.event.altKey) {
		             d3.selectAll(".cell-selected").classed("cell-selected",false);
		             d3.selectAll(".rowLabel").classed("text-selected",false);
		             d3.selectAll(".colLabel").classed("text-selected",false);
		          }
		         var p = d3.mouse(this);
		         sa.append("rect")
		         .attr({
		             rx      : 0,
		             ry      : 0,
		             class   : "selection",
		             x       : p[0],
		             y       : p[1],
		             width   : 1,
		             height  : 1
		         })
		      })
		      .on("mousemove", function() {
		         var s = sa.select("rect.selection");

		         if(!s.empty()) {
		             var p = d3.mouse(this),
		                 d = {
		                     x       : parseInt(s.attr("x"), 10),
		                     y       : parseInt(s.attr("y"), 10),
		                     width   : parseInt(s.attr("width"), 10),
		                     height  : parseInt(s.attr("height"), 10)
		                 },
		                 move = {
		                     x : p[0] - d.x,
		                     y : p[1] - d.y
		                 }
		             ;

		             if(move.x < 1 || (move.x*2<d.width)) {
		                 d.x = p[0];
		                 d.width -= move.x;
		             } else {
		                 d.width = move.x;
		             }

		             if(move.y < 1 || (move.y*2<d.height)) {
		                 d.y = p[1];
		                 d.height -= move.y;
		             } else {
		                 d.height = move.y;
		             }
		             s.attr(d);

		                 // deselect all temporary selected state objects
		             d3.selectAll('.cell-selection.cell-selected').classed("cell-selected", false);
		             d3.selectAll(".text-selection.text-selected").classed("text-selected",false);

		             d3.selectAll('.cell').filter(function(cell_d, i) {
		                 if(
		                     !d3.select(this).classed("cell-selected") &&
		                         // inner circle inside selection frame
		                     (this.x.baseVal.value)+cellSize >= d.x && (this.x.baseVal.value)<=d.x+d.width &&
		                     (this.y.baseVal.value)+cellSize >= d.y && (this.y.baseVal.value)<=d.y+d.height
		                 ) {

		                     d3.select(this)
		                     .classed("cell-selection", true)
		                     .classed("cell-selected", true);

		                     d3.select(".r"+(cell_d.row-1))
		                     .classed("text-selection",true)
		                     .classed("text-selected",true);

		                     d3.select(".c"+(cell_d.col-1))
		                     .classed("text-selection",true)
		                     .classed("text-selected",true);
		                 }
		             });
		         }
		      })
		      .on("mouseup", function() {
		            // remove selection frame
		         sa.selectAll("rect.selection").remove();

		             // remove temporary selection marker class
		         d3.selectAll('.cell-selection').classed("cell-selection", false);
		         d3.selectAll(".text-selection").classed("text-selection",false);
		      })
		      .on("mouseout", function() {
		         if(d3.event.relatedTarget.tagName=='html') {
		                 // remove selection frame
		             sa.selectAll("rect.selection").remove();
		                 // remove temporary selection marker class
		             d3.selectAll('.cell-selection').classed("cell-selection", false);
		             d3.selectAll(".rowLabel").classed("text-selected",false);
		             d3.selectAll(".colLabel").classed("text-selected",false);
		         }
		      })
		      ;
		});

	</script>

	<!-- BoxPlot1 -->
	<script type="text/javascript">
		// set the dimensions and margins of the graph
		var margin2 = {top: 10, right: 30, bottom: 30, left: 40},
			width2 = 460 - margin2.left - margin2.right,
			height2 = 400 - margin2.top - margin2.bottom;

		// append the svg object to the body of the page
		var svg2 = d3.select("#my_boxplot1")
		.append("svg")
			.attr("width", width2 + margin2.left + margin2.right)
			.attr("height", height2 + margin2.top + margin2.bottom)
		.append("g")
			.attr("transform",
				"translate(" + margin2.left + "," + margin2.top + ")");

		// Read the data and compute summary statistics for each specie
		d3.csv("{%static 'data/box_plot1.csv' %}", function(data) {

		// Compute quartiles, median, inter quantile range min and max --> these info are then used to draw the box.
		var sumstat2 = d3.nest() // nest function allows to group the calculation per level of a factor
			.key(function(d) { return d.Gender;})
			.rollup(function(d) {
			q1 = d3.quantile(d.map(function(g) { return g.Age;}).sort(d3.ascending),.25)
			median = d3.quantile(d.map(function(g) { return g.Age;}).sort(d3.ascending),.5)
			q3 = d3.quantile(d.map(function(g) { return g.Age;}).sort(d3.ascending),.75)
			interQuantileRange = q3 - q1
			min = q1 - 1.5 * interQuantileRange
			max = q3 + 1.5 * interQuantileRange
			return({q1: q1, median: median, q3: q3, interQuantileRange: interQuantileRange, min: min, max: max})
			})
			.entries(data)

		// Show the X scale
		var x2 = d3.scaleBand()
			.range([ 0, width2 ])
			.domain(["Male", "Female"])
			.paddingInner(1)
			.paddingOuter(.5)
		svg2.append("g")
			.attr("transform", "translate(0," + height2 + ")")
			.call(d3.axisBottom(x2))

		svg2.append("text")
      		.attr("transform", "translate(" + (width2/2) + " ," +
                           (height2 + margin2.top + 20) + ")")
      		.style("text-anchor", "middle")
      		.text("Gender");

		// Show the Y scale
		var y2 = d3.scaleLinear()
			.domain([0,60])
			.range([height2, 0])
		svg2.append("g").call(d3.axisLeft(y2))

		// text label for the y axis
  		svg2.append("text")
  		    .attr("transform", "rotate(-90)")
  		    .attr("y", 0 - margin2.left)
  		    .attr("x",0 - (height2 / 2))
  		    .attr("dy", "1em")
  		    .style("text-anchor", "middle")
  		    .text("Age");

		// Show the main vertical line
		svg2
			.selectAll("vertLines")
			.data(sumstat2)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x2(d.key))})
			.attr("x2", function(d){return(x2(d.key))})
			.attr("y1", function(d){return(y2(d.value.min))})
			.attr("y2", function(d){return(y2(d.value.max))})
			.attr("stroke", "black")
			.style("width", 40)

		// rectangle for the main box
		var boxWidth2 = 100
		svg2.selectAll("boxes")
			.data(sumstat2)
			.enter()
			.append("rect")
				.attr("x", function(d){return(x2(d.key)-boxWidth2/2)})
				.attr("y", function(d){return(y2(d.value.q3))})
				.attr("height", function(d){return(y2(d.value.q1)-y2(d.value.q3))})
				.attr("width", boxWidth2 )
				.attr("stroke", "black")
				.style("fill", "#69b3a2")

		// Show the median
		svg2.selectAll("medianLines")
			.data(sumstat2)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x2(d.key)-boxWidth2/2) })
			.attr("x2", function(d){return(x2(d.key)+boxWidth2/2) })
			.attr("y1", function(d){return(y2(d.value.median))})
			.attr("y2", function(d){return(y2(d.value.median))})
			.attr("stroke", "black")
			.style("width", 80)

		// Add individual points with jitter
		/*var jitterWidth = 50
		svg.selectAll("indPoints")
		.data(data)
		.enter()
		.append("circle")
			.attr("cx", function(d){return(x(d.Gender) - jitterWidth/2 + Math.random()*jitterWidth )})
			.attr("cy", function(d){return(y(d.Age))})
			.attr("r", 4)
			.style("fill", "white")
			.attr("stroke", "black")*/


		})

	</script>

	<!-- BoxPlot2 -->
	<script type="text/javascript">
		// set the dimensions and margins of the graph
		var margin3 = {top: 10, right: 50, bottom: 30, left: 60},
			width3 = 460 - margin3.left - margin3.right,
			height3 = 400 - margin3.top - margin3.bottom;

		// append the svg object to the body of the page
		var svg3 = d3.select("#my_boxplot2")
		.append("svg")
			.attr("width", width3 + margin3.left + margin3.right)
			.attr("height", height3 + margin3.top + margin3.bottom)
		.append("g")
			.attr("transform",
				"translate(" + margin3.left + "," + margin3.top + ")");

		// Read the data and compute summary statistics for each specie
		d3.csv("{%static 'data/box_plot2.csv' %}", function(data) {

		// Compute quartiles, median, inter quantile range min and max --> these info are then used to draw the box.
		var sumstat3 = d3.nest() // nest function allows to group the calculation per level of a factor
			.key(function(d) { return d.Gender;})
			.rollup(function(d) {
			q1 = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.25)
			median = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.5)
			q3 = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.75)
			interQuantileRange = q3 - q1
			min = q1 - 1.5 * interQuantileRange
			max = q3 + 1.5 * interQuantileRange
			return({q1: q1, median: median, q3: q3, interQuantileRange: interQuantileRange, min: min, max: max})
			})
			.entries(data)

		// Show the X scale
		var x3 = d3.scaleBand()
			.range([ 0, width3 ])
			.domain(["Male", "Female"])
			.paddingInner(1)
			.paddingOuter(.5)
		svg3.append("g")
			.attr("transform", "translate(0," + height3 + ")")
			.call(d3.axisBottom(x3))

		svg3.append("text")
      		.attr("transform", "translate(" + (width3/2) + " ," +
                           (height3 + margin3.top + 20) + ")")
      		.style("text-anchor", "middle")
      		.text("Gender");

		// Show the Y scale
		var y3 = d3.scaleLinear()
			.domain([0,12000])
			.range([height3, 0])
		svg3.append("g").call(d3.axisLeft(y3))

		// text label for the y axis
  		svg3.append("text")
  		    .attr("transform", "rotate(-90)")
  		    .attr("y", 0 - margin3.left)
  		    .attr("x",0 - (height3 / 2))
  		    .attr("dy", "1em")
  		    .style("text-anchor", "middle")
  		    .text("Monthly Income");

		// Show the main vertical line
		svg3
			.selectAll("vertLines")
			.data(sumstat3)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x3(d.key))})
			.attr("x2", function(d){return(x3(d.key))})
			.attr("y1", function(d){return(y3(d.value.min))})
			.attr("y2", function(d){return(y3(d.value.max))})
			.attr("stroke", "black")
			.style("width", 40)

		// rectangle for the main box
		var boxWidth3 = 100
		svg3.selectAll("boxes")
			.data(sumstat3)
			.enter()
			.append("rect")
				.attr("x", function(d){return(x3(d.key)-boxWidth3/2)})
				.attr("y", function(d){return(y3(d.value.q3))})
				.attr("height", function(d){return(y3(d.value.q1)-y3(d.value.q3))})
				.attr("width", boxWidth3 )
				.attr("stroke", "black")
				.style("fill", "#69b3a2")

		// Show the median
		svg3.selectAll("medianLines")
			.data(sumstat3)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x3(d.key)-boxWidth3/2) })
			.attr("x2", function(d){return(x3(d.key)+boxWidth3/2) })
			.attr("y1", function(d){return(y3(d.value.median))})
			.attr("y2", function(d){return(y3(d.value.median))})
			.attr("stroke", "black")
			.style("width", 80)

		// Add individual points with jitter
		/*var jitterWidth = 50
		svg.selectAll("indPoints")
		.data(data)
		.enter()
		.append("circle")
			.attr("cx", function(d){return(x(d.Gender) - jitterWidth/2 + Math.random()*jitterWidth )})
			.attr("cy", function(d){return(y(d.Age))})
			.attr("r", 4)
			.style("fill", "white")
			.attr("stroke", "black")*/


		})

	</script>

	<!-- BoxPlot3 -->
	<script type="text/javascript">
		// set the dimensions and margin4s of the graph
		var margin4 = {top: 10, right: 50, bottom: 30, left: 60},
			width4 = 1100 - margin4.left - margin4.right,
			height4 = 400 - margin4.top - margin4.bottom;

		// append the svg object to the body of the page
		var svg4 = d3.select("#my_boxplot3")
		.append("svg")
			.attr("width", width4 + margin4.left + margin4.right)
			.attr("height", height4 + margin4.top + margin4.bottom)
		.append("g")
			.attr("transform",
				"translate(" + margin4.left + "," + margin4.top + ")");

		// Read the data and compute summary statistics for each specie
		d3.csv("{%static 'data/box_plot3.csv' %}", function(data) {

		// Compute quartiles, median, inter quantile range min and max --> these info are then used to draw the box.
		var sumstat4 = d3.nest() // nest function allows to group the calculation per level of a factor
			.key(function(d) { return d.JobRole;})
			.rollup(function(d) {
			q1 = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.25)
			median = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.5)
			q3 = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.75)
			interQuantileRange = q3 - q1
			min = q1 - 1.5 * interQuantileRange
			max = q3 + 1.5 * interQuantileRange
			return({q1: q1, median: median, q3: q3, interQuantileRange: interQuantileRange, min: min, max: max})
			})
			.entries(data)

		var x_data = [];
		for (var i = 0; i < data.length; i++) {
 			 x_data.push(data[i].JobRole);
		};

		function unique_array(value, index, self) {
    		return self.indexOf(value) === index;
		}
		var unique_x_data = x_data.filter( unique_array );

		// Show the X scale
		var x4 = d3.scaleBand()
			.range([ 0, width4 ])
			.domain(unique_x_data)
			.paddingInner(1)
			.paddingOuter(.5)
		svg4.append("g")
			.attr("transform", "translate(0," + height4 + ")")
			.call(d3.axisBottom(x4))

		svg4.append("text")
      		.attr("transform", "translate(" + (width4/2) + " ," +
                           (height4 + margin4.top + 20) + ")")
      		.style("text-anchor", "middle")
      		.text("Job Role");

		// Show the Y scale
		var y4 = d3.scaleLinear()
			.domain([0,12000])
			.range([height4, 0])
		svg4.append("g").call(d3.axisLeft(y4))

		// text label for the y axis
  		svg4.append("text")
  		    .attr("transform", "rotate(-90)")
  		    .attr("y", 0 - margin4.left)
  		    .attr("x",0 - (height4 / 2))
  		    .attr("dy", "1em")
  		    .style("text-anchor", "middle")
  		    .text("Monthly Income");

		// Show the main vertical line
		svg4
			.selectAll("vertLines")
			.data(sumstat4)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x4(d.key))})
			.attr("x2", function(d){return(x4(d.key))})
			.attr("y1", function(d){return(y4(d.value.min))})
			.attr("y2", function(d){return(y4(d.value.max))})
			.attr("stroke", "black")
			.style("width", 40)

		// rectangle for the main box
		var boxWidth4 = 100
		svg4.selectAll("boxes")
			.data(sumstat4)
			.enter()
			.append("rect")
				.attr("x", function(d){return(x4(d.key)-boxWidth4/2)})
				.attr("y", function(d){return(y4(d.value.q3))})
				.attr("height", function(d){return(y4(d.value.q1)-y4(d.value.q3))})
				.attr("width", boxWidth4 )
				.attr("stroke", "black")
				.style("fill", "#69b3a2")

		// Show the median
		svg4.selectAll("medianLines")
			.data(sumstat4)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x4(d.key)-boxWidth4/2) })
			.attr("x2", function(d){return(x4(d.key)+boxWidth4/2) })
			.attr("y1", function(d){return(y4(d.value.median))})
			.attr("y2", function(d){return(y4(d.value.median))})
			.attr("stroke", "black")
			.style("width", 80)

		// Add individual points with jitter
		/*var jitterWidth = 50
		svg.selectAll("indPoints")
		.data(data)
		.enter()
		.append("circle")
			.attr("cx", function(d){return(x(d.Gender) - jitterWidth/2 + Math.random()*jitterWidth )})
			.attr("cy", function(d){return(y(d.Age))})
			.attr("r", 4)
			.style("fill", "white")
			.attr("stroke", "black")*/


		})

	</script>

	<!-- BoxPlot4 -->
	<script type="text/javascript">
		// set the dimensions and margin5s of the graph
		var margin5 = {top: 10, right: 50, bottom: 30, left: 60},
			width5 = 1100 - margin5.left - margin5.right,
			height5 = 400 - margin5.top - margin5.bottom;

		// append the svg object to the body of the page
		var svg5 = d3.select("#my_boxplot4")
		.append("svg")
			.attr("width", width5 + margin5.left + margin5.right)
			.attr("height", height5 + margin5.top + margin5.bottom)
		.append("g")
			.attr("transform",
				"translate(" + margin5.left + "," + margin5.top + ")");

		// Read the data and compute summary statistics for each specie
		d3.csv("{%static 'data/box_plot4.csv' %}", function(data) {

		// Compute quartiles, median, inter quantile range min and max --> these info are then used to draw the box.
		var sumstat5 = d3.nest() // nest function allows to group the calculation per level of a factor
			.key(function(d) { return d.DistanceFromHome;})
			.rollup(function(d) {
			q1 = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.25)
			median = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.5)
			q3 = d3.quantile(d.map(function(g) { return g.MonthlyIncome;}).sort(d3.ascending),.75)
			interQuantileRange = q3 - q1
			min = q1 - 1.5 * interQuantileRange
			max = q3 + 1.5 * interQuantileRange
			return({q1: q1, median: median, q3: q3, interQuantileRange: interQuantileRange, min: min, max: max})
			})
			.entries(data)

		var x_data2 = [];
		for (var i = 0; i < data.length; i++) {
 			 x_data2.push(data[i].DistanceFromHome);
		};

		function unique_array2(value, index, self) {
    		return self.indexOf(value) === index;
		}
		var unique_x_data2 = x_data2.filter( unique_array2 );

		// Show the X scale
		var x5 = d3.scaleBand()
			.range([ 0, width5 ])
			.domain(unique_x_data2.sort())
			.paddingInner(1)
			.paddingOuter(.5)
		svg5.append("g")
			.attr("transform", "translate(0," + height5 + ")")
			.call(d3.axisBottom(x5))

		svg5.append("text")
      		.attr("transform", "translate(" + (width5/2) + " ," +
                           (height5 + margin5.top + 20) + ")")
      		.style("text-anchor", "middle")
      		.text("DistanceFromHome");

		// Show the Y scale
		var y5 = d3.scaleLinear()
			.domain([0,25000])
			.range([height5, 0])
		svg5.append("g").call(d3.axisLeft(y5))

		// text label for the y axis
  		svg5.append("text")
  		    .attr("transform", "rotate(-90)")
  		    .attr("y", 0 - margin5.left)
  		    .attr("x",0 - (height5 / 2))
  		    .attr("dy", "1em")
  		    .style("text-anchor", "middle")
  		    .text("MonthlyIncome");

		// Show the main vertical line
		svg5
			.selectAll("vertLines")
			.data(sumstat5)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x5(d.key))})
			.attr("x2", function(d){return(x5(d.key))})
			.attr("y1", function(d){return(y5(d.value.min))})
			.attr("y2", function(d){return(y5(d.value.max))})
			.attr("stroke", "black")
			.style("width", 40)

		// rectangle for the main box
		var boxWidth5 = 10
		svg5.selectAll("boxes")
			.data(sumstat5)
			.enter()
			.append("rect")
				.attr("x", function(d){return(x5(d.key)-boxWidth5/2)})
				.attr("y", function(d){return(y5(d.value.q3))})
				.attr("height", function(d){return(y5(d.value.q1)-y5(d.value.q3))})
				.attr("width", boxWidth5 )
				.attr("stroke", "black")
				.style("fill", "#69b3a2")

		// Show the median
		svg5.selectAll("medianLines")
			.data(sumstat5)
			.enter()
			.append("line")
			.attr("x1", function(d){return(x5(d.key)-boxWidth5/2) })
			.attr("x2", function(d){return(x5(d.key)+boxWidth5/2) })
			.attr("y1", function(d){return(y5(d.value.median))})
			.attr("y2", function(d){return(y5(d.value.median))})
			.attr("stroke", "black")
			.style("width", 80)

		// Add individual points with jitter
		/*var jitterWidth = 50
		svg.selectAll("indPoints")
		.data(data)
		.enter()
		.append("circle")
			.attr("cx", function(d){return(x(d.Gender) - jitterWidth/2 + Math.random()*jitterWidth )})
			.attr("cy", function(d){return(y(d.Age))})
			.attr("r", 4)
			.style("fill", "white")
			.attr("stroke", "black")*/


		})

	</script>

{% endblock content %}